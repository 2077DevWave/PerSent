name: Python Tests

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python 3.9
      uses: actions/setup-python@v5
      with:
        python-version: '3.9'
    
    - name: Install Persian Dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y libgl1
        
    - name: Install Python Dependencies
      run: |
        pip install -e .[dev]
        pip install hazm gensim scikit-learn tqdm pandas joblib
    
    - name: Run Tests
      run: |
        pytest tests/ --cov=persent --cov-report=xml
      env:
        PYTHONPATH: ${{ github.workspace }}

    - name: Upload Coverage
      uses: codecov/codecov-action@v3
